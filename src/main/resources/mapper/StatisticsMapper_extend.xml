<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.unicom.wobeyond.mapper.StatisticsMapper_extend" >
  
 <select id="selectOrderList" resultType="com.unicom.wobeyond.vo.statistics.OrderVO">

		 	SELECT
		 		A.PROVINCE AS province,
		 		A.CITY AS city,
		 		A.DISTRICT AS district,
		 		A.OPERATORNAME AS operatorname,
		 		B.CUSTOMERNAME AS customername,
		 		LEFT(CONCAT(C.SERIAL_NUMBER,''),11) AS serialNumber,
		 		D.PROD_NAME AS prodName,
		 		T.BUSI_ORDER_DATE AS busiOrderDate,
		 		T.BUSI_CELLNO AS busiCellno,
		 		T.pay_flag AS payFlag,
				(
					CASE
					WHEN T.pay_flag=1 THEN
					    '已签约'
					WHEN T.pay_flag=0 THEN
					    '未签约'
					ELSE
					    '未知'
					END
				) payFlagName
			FROM
					busi_order T,
					account A,
					customer B,
					SERIAL C,
					prod D
			WHERE T.OPER_ID=A.OPERATORID
			AND T.CUSTID=B.CUSTID
			AND T.SERIAL_ID=C.SERIAL_ID
			AND T.PROD_ID=D.PROD_ID

 </select>

 <select id="selectSignCustomerCount" resultType="CustomerCountVO">

		 	SELECT  b.district as name,
		 	        COUNT(*) as value
            FROM
                    busi_order a,account b
            WHERE a.oper_id=b.operatorid
            AND a.pay_flag=1
            GROUP BY b.district;

 </select>

 <select id="selectSignFunnelCount" resultType="SignFunnelCountVO">

     SELECT * FROM (
         (SELECT COUNT(*) AS notsign FROM busi_order WHERE  pay_flag=0) a,
         -- 一个月内签约 14
         (SELECT COUNT(*) AS monthsign FROM busi_order WHERE busi_order_date BETWEEN DATE_SUB(NOW(),INTERVAL 1 MONTH) AND NOW()) b,
         -- 一年以上签约
         (SELECT COUNT(*) AS oneyearsign FROM busi_order WHERE busi_order_date
          &lt; DATE_SUB(NOW(),INTERVAL 12 MONTH) ) c,
         -- 三年以上签约
         (SELECT COUNT(*) AS threeyearsign FROM busi_order WHERE busi_order_date
          &lt; DATE_SUB(NOW(),INTERVAL 36 MONTH)) d
     )

 </select>

</mapper>